{
  "name": "Inspector Twin — Architecture",
  "version": "1.0.0",
  "generated_at": "2026-02-18",
  "description": "Structured representation of the Inspector Twin architecture covering layers, components, and flows used to render the diagram.\n  ",
  "layers": [
    {
      "id": "frontend",
      "title": "Frontend — React 18 + TypeScript + Vite",
      "path": "apps/renderer",
      "components": [
        {
          "id": "ui_navigation",
          "title": "UI & Navigation",
          "type": "ui",
          "pages": [
            "Projects",
            "Twin Designer",
            "Scenarios",
            "Simulation",
            "Findings",
            "Reports",
            "Settings"
          ],
          "state": {
            "library": "Zustand",
            "store_path": "apps/renderer/src/store/appStore.ts"
          },
          "notes": [
            "Renders in WebView (Tauri/Electron) or browser (dev)"
          ]
        },
        {
          "id": "data_access",
          "title": "Data Access",
          "type": "integration",
          "primary": {
            "api": "window.electronAPI",
            "source": "apps/desktop/src/preload.ts",
            "transport": "IPC (Electron)"
          },
          "fallback": {
            "api": "mockAPI",
            "source": "apps/renderer/src/utils/mockAPI.ts",
            "storage": "localStorage"
          }
        },
        {
          "id": "ui_deps",
          "title": "Key UI Dependencies",
          "type": "library",
          "dependencies": [
            "React Flow (canvas)",
            "Monaco Editor (policy DSL)",
            "Zod (validation)",
            "pdf-lib (report preview/export)",
            "React Router",
            "Styling/Icons"
          ]
        }
      ]
    },
    {
      "id": "middleware",
      "title": "Middleware — Domain Packages",
      "path": "packages/*",
      "components": [
        {
          "id": "core_sim",
          "name": "@inspectortwin/core-sim",
          "path": "packages/core-sim",
          "responsibilities": [
            "Graph validation",
            "Routing and packet flow simulation",
            "Failure injection (links/nodes)",
            "Policy evaluation hooks"
          ],
          "used_by": ["backend.electron.simulation:run"],
          "key_files": [
            "src/index.ts",
            "src/simulator.ts",
            "src/validation.ts",
            "src/blast-radius.ts"
          ]
        },
        {
          "id": "project_store",
          "name": "@inspectortwin/project-store",
          "path": "packages/project-store",
          "responsibilities": [
            "Repositories for projects, topologies, scenarios, runs, findings, reports",
            "DB access via better-sqlite3"
          ],
          "used_by": ["backend.electron.ipc_handlers"],
          "key_files": [
            "src/index.ts",
            "src/migrations.ts",
            "src/repositories.ts"
          ]
        },
        {
          "id": "policy_dsl",
          "name": "@inspectortwin/policy-dsl",
          "path": "packages/policy-dsl",
          "responsibilities": ["Firewall policy parser/validator"],
          "key_files": ["src/policy.ts"]
        },
        {
          "id": "report_kit",
          "name": "@inspectortwin/report-kit",
          "path": "packages/report-kit",
          "responsibilities": ["Generate JSON/PDF reports using pdf-lib"],
          "used_by": ["backend.electron.report:generate"],
          "key_files": [
            "src/index.ts",
            "src/report-generator.ts"
          ]
        },
        {
          "id": "lab_runtime",
          "name": "@inspectortwin/lab-runtime",
          "path": "packages/lab-runtime",
          "responsibilities": [
            "Optional Docker orchestration for local lab",
            "Localhost-only enforcement"
          ],
          "used_by": ["backend.electron.lab:*"],
          "key_files": ["src/lab-runtime.ts"]
        },
        {
          "id": "shared",
          "name": "@inspectortwin/shared",
          "path": "packages/shared",
          "responsibilities": ["Common types", "Zod schemas", "Sample data"],
          "key_files": [
            "src/index.ts",
            "src/schemas.ts",
            "src/sample-data.ts"
          ]
        }
      ]
    },
    {
      "id": "backend",
      "title": "Backend Hosts — Desktop Shells",
      "components": [
        {
          "id": "electron",
          "name": "Electron Main Process",
          "path": "apps/desktop/src/main.ts",
          "notes": [
            "Rules of Engagement (ROE) enforcement",
            "IPC bridge exposed via preload with contextIsolation"
          ],
          "ipc_channels": [
            "project:create",
            "project:getAll",
            "project:getById",
            "project:update",
            "project:delete",
            "topology:create",
            "topology:getByProjectId",
            "topology:getById",
            "topology:update",
            "topology:delete",
            "scenario:create",
            "scenario:getByProjectId",
            "scenario:getById",
            "scenario:delete",
            "simulation:run",
            "simulation:getRuns",
            "simulation:getRunById",
            "findings:getByRunId",
            "report:generate",
            "report:getByRunId",
            "lab:start",
            "lab:stop",
            "lab:getStatus",
            "settings:get",
            "settings:set"
          ],
          "preload": "apps/desktop/src/preload.ts",
          "persists": [
            { "target": "SQLite DB", "path": "userData/inspectortwin.db" },
            { "target": "Reports", "path": "Documents/InspectorTwin/<filename>" }
          ],
          "uses_packages": [
            "@inspectortwin/project-store",
            "@inspectortwin/core-sim",
            "@inspectortwin/report-kit",
            "@inspectortwin/lab-runtime"
          ]
        },
        {
          "id": "tauri",
          "name": "Tauri v2 Backend",
          "path": "src-tauri/src/main.rs",
          "notes": [
            "Rust main process, secure WebView",
            "Shell plugin enabled",
            "Runs alongside Vite during dev:tauri"
          ]
        }
      ]
    },
    {
      "id": "resources",
      "title": "System Resources",
      "components": [
        {
          "id": "sqlite_db",
          "name": "SQLite DB",
          "path": "<userData>/inspectortwin.db",
          "used_by": ["backend.electron"],
          "purpose": "Persist projects, topologies, scenarios, runs, findings, reports"
        },
        {
          "id": "documents",
          "name": "Report Outputs",
          "path": "<Documents>/InspectorTwin",
          "used_by": ["backend.electron.report:generate"],
          "formats": ["json", "pdf"]
        },
        {
          "id": "docker",
          "name": "Docker Daemon",
          "scope": "localhost only",
          "used_by": ["@inspectortwin/lab-runtime"],
          "optional": true
        }
      ]
    },
    {
      "id": "tooling",
      "title": "Scripts & Tooling",
      "components": [
        { "id": "script_build", "name": "scripts/build.sh", "purpose": "Build workspace packages" },
        { "id": "script_seed", "name": "scripts/seed.mjs", "purpose": "Seed sample data" },
        { "id": "script_smoke", "name": "scripts/smoke-test.sh", "purpose": "Run Playwright smoke tests" },
        { "id": "playwright_config", "name": "playwright.config.ts", "purpose": "E2E test configuration" },
        {
          "id": "dev_commands",
          "name": "dev commands",
          "at_root_package_json": true,
          "commands": [
            { "script": "dev:tauri", "runs": "Vite renderer + Tauri dev" },
            { "script": "dev:renderer", "runs": "Vite renderer only" },
            { "script": "dev:desktop", "runs": "Electron app dev" }
          ]
        }
      ]
    }
  ],
  "flows": [
    { "from": "frontend.data_access.primary.api", "to": "backend.electron.ipc_channels", "type": "request/response", "description": "Renderer invokes Electron IPC via window.electronAPI" },
    { "from": "frontend.data_access.fallback.api", "to": "browser.localStorage", "type": "data-access", "description": "Browser-only mode persists to localStorage using mockAPI" },
    { "from": "backend.electron", "to": "middleware.project_store", "type": "library-call", "description": "IPC handlers call repositories for CRUD" },
    { "from": "backend.electron", "to": "middleware.core_sim", "type": "library-call", "description": "simulation:run uses SimulationEngine to execute scenarios" },
    { "from": "backend.electron", "to": "middleware.report_kit", "type": "library-call", "description": "report:generate renders JSON/PDF outputs" },
    { "from": "backend.electron", "to": "middleware.lab_runtime", "type": "library-call", "description": "lab:* controls local Docker lab (localhost-only)" },
    { "from": "middleware.project_store", "to": "resources.sqlite_db", "type": "data-write", "description": "Persist entities to SQLite under userData" },
    { "from": "middleware.report_kit", "to": "resources.documents", "type": "data-write", "description": "Write reports to Documents/InspectorTwin" },
    { "from": "middleware.lab_runtime", "to": "resources.docker", "type": "orchestration", "description": "Launch and manage containers bound to 127.0.0.1" }
  ],
  "legend": { "arrows": { "solid": "primary data/control flow", "dotted": "tooling/dev flow" } }
}
