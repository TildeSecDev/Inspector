{
  "info": {
    "name": "BlockBash Sandbox",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "API collection to validate core user flows: health, auth, profile, progress, social, admin, and workshop validation."
  },
  "item": [
    { "name": "Health", "request": { "method": "GET", "url": "{{baseUrl}}/health" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('health 200', function(){ pm.response.to.have.status(200); });",
      "pm.test('health body contains ok', function(){ pm.expect(pm.response.text()).to.include('ok'); });"
    ], "type": "text/javascript" } }] },

    { "name": "Register", "event": [
      { "listen": "prerequest", "script": { "exec": [
        "if(!pm.environment.get('timestamp')){ pm.environment.set('timestamp', Date.now()); }",
        "if(!pm.environment.get('username')){ pm.environment.set('username', 'postman_user_'+pm.environment.get('timestamp')); }",
        "if(!pm.environment.get('email')){ pm.environment.set('email', 'postman_user_'+pm.environment.get('timestamp')+'@example.com'); }"
      ], "type": "text/javascript" } },
      { "listen": "test", "script": { "exec": [
        "pm.test('register 200', function(){ pm.response.to.have.status(200); });",
        "const body = pm.response.json();",
        "pm.test('register success true', function(){ pm.expect(body.success).to.eql(true); });",
        "pm.environment.set('userId', body.userId);"
      ], "type": "text/javascript" } }
    ], "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/auth/register", "body": { "mode": "raw", "raw": "{\n  \"name\": \"{{username}}\",\n  \"email\": \"{{email}}\",\n  \"password\": \"{{password}}\",\n  \"organisation\": \"school\"\n}" } } },

    { "name": "Login", "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/auth/login", "body": { "mode": "raw", "raw": "{\n  \"email\": \"{{email}}\",\n  \"password\": \"{{password}}\"\n}" } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('login 200', function(){ pm.response.to.have.status(200); });",
      "const body = pm.response.json();",
      "pm.test('login success true', function(){ pm.expect(body.success).to.eql(true); });"
    ], "type": "text/javascript" } }] },

    { "name": "Me", "request": { "method": "GET", "url": "{{baseUrl}}/auth/me" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('me 200', function(){ pm.response.to.have.status(200); });"
    ], "type": "text/javascript" } }] },

    { "name": "Profile", "request": { "method": "GET", "url": { "raw": "{{baseUrl}}/user/profile?userId={{email}}", "host": ["{{baseUrl}}"], "path": ["user","profile"], "query": [{ "key": "userId", "value": "{{email}}" }] } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('profile 200', function(){ pm.response.to.have.status(200); });",
      "const b = pm.response.json(); pm.test('profile has name/email', function(){ pm.expect(b.name).to.be.a('string'); pm.expect(b.email).to.be.a('string'); });"
    ], "type": "text/javascript" } }] },

    { "name": "Preferred OS (get)", "request": { "method": "GET", "url": "{{baseUrl}}/user/preferred_os" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('preferred_os 200/401', function(){ pm.expect([200,401]).to.include(pm.response.code); });"
    ], "type": "text/javascript" } }] },

    { "name": "Leaderboard", "request": { "method": "GET", "url": "{{baseUrl}}/leaderboard" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('leaderboard 200', function(){ pm.response.to.have.status(200); });",
      "pm.test('leaderboard is array', function(){ pm.expect(pm.response.json()).to.be.an('array'); });"
    ], "type": "text/javascript" } }] },

    { "name": "Add Friend", "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/user/add_friend", "body": { "mode": "raw", "raw": "{\n  \"userId\": \"{{username}}\",\n  \"friendEmail\": \"friend@example.com\"\n}" } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('add friend ok', function(){ const b = pm.response.json(); pm.expect(b.ok).to.be.true; });"
    ], "type": "text/javascript" } }] },

    { "name": "Remove Friend", "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/user/remove_friend", "body": { "mode": "raw", "raw": "{\n  \"userId\": \"{{username}}\",\n  \"friendEmail\": \"friend@example.com\"\n}" } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('remove friend ok', function(){ const b = pm.response.json(); pm.expect(b.ok).to.be.true; });"
    ], "type": "text/javascript" } }] },

    { "name": "Command Guard (banned)", "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/ws/command", "body": { "mode": "raw", "raw": "{\n  \"command\": \"rm -rf /\"\n}" } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('banned command rejected', function(){ pm.expect([403,200]).to.include(pm.response.code); if(pm.response.code===200){ const b=pm.response.json(); pm.expect(b.ok).to.eql(true); } });"
    ], "type": "text/javascript" } }] },

    { "name": "Admin Login", "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/auth/login", "body": { "mode": "raw", "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"admin123\"\n}" } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('admin login ok', function(){ pm.response.to.have.status(200); pm.expect(pm.response.json().success).to.be.true; });"
    ], "type": "text/javascript" } }] },

    { "name": "Admin Active Sessions", "request": { "method": "GET", "url": "{{baseUrl}}/admin/active_sessions" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('admin active_sessions 200', function(){ pm.response.to.have.status(200); });"
    ], "type": "text/javascript" } }] },

    { "name": "Admin Recent Commands", "request": { "method": "GET", "url": "{{baseUrl}}/admin/recent_commands" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('admin recent_commands 200', function(){ pm.response.to.have.status(200); });"
    ], "type": "text/javascript" } }] },

    { "name": "Admin User Progress", "request": { "method": "GET", "url": "{{baseUrl}}/admin/user_progress" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('admin user_progress 200', function(){ pm.response.to.have.status(200); });"
    ], "type": "text/javascript" } }] },

    { "name": "Admin Achievements", "request": { "method": "GET", "url": "{{baseUrl}}/admin/achievements" }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('admin achievements 200', function(){ pm.response.to.have.status(200); });"
    ], "type": "text/javascript" } }] },

    { "name": "Workshop Validate (mira step 1)", "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/ws/validate", "body": { "mode": "raw", "raw": "{\n  \"lesson_id\": \"mira\",\n  \"step\": 1,\n  \"command\": \"airodump-ng wlan0\"\n}" } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('mira step1 pass', function(){ var b=pm.response.json(); pm.expect(b.pass).to.be.true; });"
    ], "type": "text/javascript" } }] },

    { "name": "Workshop Validate (mira submit flag)", "request": { "method": "POST", "header": [{ "key": "Content-Type", "value": "application/json" }], "url": "{{baseUrl}}/ws/validate", "body": { "mode": "raw", "raw": "{\n  \"lesson_id\": \"mira\",\n  \"step\": 1,\n  \"command\": \"submit-flag SSID_FLAG{coffeeshop_spoofed}\"\n}" } }, "event": [{ "listen": "test", "script": { "exec": [
      "pm.test('mira flag accepted', function(){ var b=pm.response.json(); pm.expect(b.pass).to.be.true; });"
    ], "type": "text/javascript" } }] }
  ]
}
