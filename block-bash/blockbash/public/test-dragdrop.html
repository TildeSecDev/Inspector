<!DOCTYPE html>
<html>
<head>
  <title>Network Drag-Drop Test</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    #test-blocks { border: 1px solid #ccc; padding: 10px; margin: 10px 0; background: #f5f5f5; }
    #network-drop-area { 
      border: 2px dashed #007acc; 
      padding: 20px; 
      min-height: 300px; 
      margin: 10px 0; 
      background: #1e1e1e;
      color: white;
    }
    .network-block { 
      display: inline-block; 
      padding: 10px; 
      margin: 5px; 
      background: #007acc; 
      color: white; 
      cursor: move; 
      border-radius: 4px;
    }
    .network-device {
      position: absolute;
      background: #1f1f1f;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 10px;
      width: 80px;
      height: 70px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Network Block Drag-Drop Test</h1>
  
  <div id="test-blocks">
    <h3>Available Network Blocks (drag these):</h3>
    <div class="network-block" draggable="true" data-device-type="router" data-category="routers">
      Router 1941
    </div>
    <div class="network-block" draggable="true" data-device-type="switch" data-category="switches">
      Switch 2960
    </div>
    <div class="network-block" draggable="true" data-device-type="end-device" data-category="end-devices">
      PC Workstation
    </div>
  </div>
  
  <div id="network-drop-area">
    <h3>Network Canvas (drop here):</h3>
    <p>Drag network blocks from above into this area.</p>
  </div>
  
  <div id="debug-output">
    <h3>Debug Output:</h3>
    <ul id="debug-log"></ul>
  </div>

  <script>
    let nextBlockId = 1;
    
    function log(message) {
      console.log(message);
      const logEl = document.getElementById('debug-log');
      const li = document.createElement('li');
      li.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
      logEl.appendChild(li);
    }
    
    // Setup drag handlers for blocks
    document.querySelectorAll('.network-block').forEach(block => {
      block.addEventListener('dragstart', (e) => {
        log(`Drag started: ${block.textContent.trim()}`);
        
        const dragData = {
          type: block.dataset.deviceType,
          name: block.textContent.trim(),
          category: block.dataset.category,
          deviceType: block.dataset.deviceType,
          isNetworkBlock: true,
          template: `<div>${block.textContent.trim()}</div>`
        };
        
        e.dataTransfer.setData('text/plain', JSON.stringify(dragData));
        log(`Drag data set: ${JSON.stringify(dragData)}`);
      });
    });
    
    // Setup drop handlers for network area
    const networkArea = document.getElementById('network-drop-area');
    
    networkArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'copy';
      log(`Dragover: ${e.clientX}, ${e.clientY}`);
    });
    
    networkArea.addEventListener('drop', (e) => {
      e.preventDefault();
      log('Drop event triggered!');
      
      try {
        const dataString = e.dataTransfer.getData('text/plain');
        log(`Raw data: ${dataString}`);
        
        const data = JSON.parse(dataString);
        log(`Parsed data: ${JSON.stringify(data)}`);
        
        // Create network device element
        const device = document.createElement('div');
        device.className = 'network-device';
        device.id = `device-${nextBlockId++}`;
        
        const iconMap = {
          'router': 'üì°',
          'switch': 'üîÄ',
          'end-device': 'üíª'
        };
        
        const icon = iconMap[data.deviceType] || 'üñ•Ô∏è';
        
        device.innerHTML = `
          <div style="font-size: 20px;">${icon}</div>
          <div>${data.name}</div>
        `;
        
        // Position at drop location
        const rect = networkArea.getBoundingClientRect();
        device.style.left = (e.clientX - rect.left - 40) + 'px';
        device.style.top = (e.clientY - rect.top - 35) + 'px';
        
        networkArea.appendChild(device);
        log(`Device created: ${data.name} at ${device.style.left}, ${device.style.top}`);
        
      } catch (error) {
        log(`Error: ${error.message}`);
      }
    });
    
    log('Drag-drop test page loaded');
  </script>
</body>
</html>